#include "hardware.h"

int main() {

	init_hardware();

	uint16_t prev_x = 0, prev_y = 0;

	uint16_t new_x, new_y;

	uint8_t sprite[384] = {
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x00,0x90,0x09,0x0F,0xF0,0xFF,0x00,0x90,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0xFF,0x00,0x90,0xFF,0x0F,0xF0,0xFF,0x00,0x90,0xFF,0x0F,0xF0,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0xFF,0x00,0x90,0x09,0x0F,0xF0,0xFF,0x0F,0xF0,0x09,0x0F,0xF0,0xFF,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0x09,0x0F,0xF0,0xFF,0x0F,0xF0,0xFF,0x00,0x90,0x09,0x00,0x90,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xF0,0xFF,0x0F,0xF0,0xFF,0x0F,0xF0,0xFF,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x00,0x90,0xF0,0x00,0x90,0x09,0x00,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0x09,0x00,0x90,0xF0,0x00,0x90,0x09,0x0F,0x00,0x09,0x00,0x90,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x00,0x90,0x09,0x00,0x90,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0x09,0x00,0x90,0x09,0x00,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x0F,0xF0,0x09,0x0F,0x00,0xFF,0x0F,0x00,0xF0,0x0F,0xF0,0xF0,0x00,0x90,0xFF,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x0F,0xF0,0xFF,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0xF0,0xFF,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x0F,0xF0,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0xF0,0x0F,0x00,0xFF,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x0F,0x00,0xF0,0x00,0x00,0x00,0x0F,0x00,0xF0,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0x09,0x00,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x00,0x90,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x00,0x90,0x09,0x00,0x90,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x00,0x90,0x09,0x00,0x90,0x00,0x00,0x00
	};

	// clear screen
	fill_rect(0, 0, 160, 128, 0x00, 0x00, 0x00);

	// draw sprite
	draw_sprite(prev_x, prev_y, 16, 16, sprite);

	while (1) {

		new_x = prev_x + (get_x1024() >> 7);
		new_y = prev_y + (get_y1024() >> 7);

		if (new_x < 4) {
			new_x = 0;
		} else {
			new_x -= 4;
		}

		if (new_y < 4) {
			new_y = 0;
		} else {
			new_y -= 4;
		}

		if (new_x > 160 - 16)
			new_x = 160 - 16;

		if (new_y > 128 - 16)
			new_y = 128 - 16;

		if (new_x != prev_x || new_y != prev_y) {

			// clear on x
			if (prev_x < new_x)
				fill_rect(prev_x, prev_y, new_x - prev_x, 16, 0x00, 0x00, 0x00);
			else
				fill_rect(new_x + 16, prev_y, prev_x - new_x, 16, 0x00, 0x00, 0x00);

			// clear on y
			if (prev_y < new_y)
				fill_rect(prev_x, prev_y, 16, new_y - prev_y, 0x00, 0x00, 0x00);
			else
				fill_rect(prev_x, new_y + 16, 16, prev_y - new_y, 0x00, 0x00, 0x00);

			// draw sprite
			draw_sprite(prev_x = new_x, prev_y = new_y, 16, 16, sprite);
		}

		sleep();
	}
}
